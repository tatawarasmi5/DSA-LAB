#include <iostream>
#include <string>
using namespace std;

// hash function for IP addresses (string -> int)
int hashIP(const string& ip) {
    int hash = 0;
    for (char c : ip) {
        hash += (int)c;  // sum ASCII values
    }
    return hash;
}

int main() {
    int s, r;
    cout << "Enter number of servers: ";
    cin >> s;
    cout << "Enter number of requests: ";
    cin >> r;

    string* requests = new string[r];   // store all IP requests
    string* servers = new string[s];    // hash table representing servers
    string* failed = new string[r];     // store failed requests
    int failCount = 0;

    // Initialize servers as empty
    for (int i = 0; i < s; i++) {
        servers[i] = "";
    }

    cout << "\nEnter " << r << " IP addresses:\n";
    for (int i = 0; i < r; i++) {
        cout << "Request " << i + 1 << ": ";
        cin >> requests[i];
    }

    cout << "\n--- Load Balancer Assignment (with Linear Probing) ---\n";
    for (int i = 0; i < r; i++) {
        string ip = requests[i];
        int hash_val = hashIP(ip);
        int serverID = hash_val % s;

        // Collision handling with linear probing
        bool assigned = false;
        if (servers[serverID] == "") {
            servers[serverID] = ip;
            assigned = true;
        } else {
            int new_pos = (serverID + 1) % s;
            while (servers[new_pos] != "" && new_pos != serverID) {
                new_pos = (new_pos + 1) % s;
            }
            if (servers[new_pos] == "") {
                servers[new_pos] = ip;
                serverID = new_pos;
                assigned = true;
            }
        }

        if (assigned) {
            cout << "IP " << ip 
                 << " is assigned to Server " << serverID + 1 << "\n";
        } else {
            cout << "IP " << ip 
                 << "All servers busy, request failed.\n";
            failed[failCount++] = ip;
        }
    }

    cout << "\n--- Final Server Status ---\n";
    for (int i = 0; i < s; i++) {
        if (servers[i] == "")
            cout << "Server " << i + 1 << ": [empty]\n";
        else
            cout << "Server " << i + 1 << ": IP " << servers[i] << "\n";
    }

    if (failCount > 0) {
        cout << "\n--- Failed Requests ---\n";
        for (int i = 0; i < failCount; i++) {
            cout << failed[i] << "\n";
        }
    }

    delete[] requests;
    delete[] servers;
    delete[] failed;

    return 0;
}
